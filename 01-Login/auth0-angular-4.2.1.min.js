angular.module("auth0",["auth0.service","auth0.utils","auth0.directives"]).run(["auth",function(n){n.hookEvents()}]),angular.module("auth0.utils",[]).provider("authUtils",function(){var n={capitalize:function(n){return n?n.charAt(0).toUpperCase()+n.substring(1).toLowerCase():null},fnName:function(n){var t=n.toString();return t=t.substr("function ".length),t=t.substr(0,t.indexOf("(")),t?t.trim():t}};angular.extend(this,n),this.$get=["$rootScope","$q",function(t,i){var e={};return angular.extend(e,n),e.safeApply=function(n){var i=t.$root.$$phase;"$apply"===i||"$digest"===i?n&&"function"==typeof n&&n():t.$apply(n)},e.callbackify=function(n,t,i,r){return angular.isFunction(n)?function(o){o=Array.prototype.slice.call(arguments);var a=function(n,e,r){return n?void(i&&i(n)):(r=Array.prototype.slice.call(arguments,1),void(t&&t.apply(null,r)))};(t||i)&&o.push(e.applied(a)),n.apply(r,o)}:void 0},e.promisify=function(n,t){return angular.isFunction(n)?function(r){r=Array.prototype.slice.call(arguments);var o=i.defer(),a=function(n,t,i){return n?void o.reject(n):(i=Array.prototype.slice.call(arguments,1),void o.resolve(i.length>1?i:t))};return r.push(e.applied(a)),n.apply(t,r),o.promise.spread=o.promise.spread||function(n,t){return o.promise.then(function(t){return Array.isArray(t)?n.apply(null,t):n(t)},t)},o.promise}:void 0},e.applied=function(n){return function(t,i){t=t,i=i;var r=arguments;e.safeApply(function(){n.apply(null,r)})}},e}]}),angular.module("auth0.service",["auth0.utils"]).provider("auth",["authUtilsProvider",function(n){function t(n,t){t=t||o.lib;var i=a[t].library();return i[a[t][n]]}function i(n,t){return t=t||o.lib,a[t][n]}function e(t){if(t)return{lib:n.fnName(t),constructor:t};if(null!=window.Auth0Lock)return{lib:"Auth0Lock",constructor:window.Auth0Lock};if(null!=window.Auth0)return{lib:"Auth0",constructor:window.Auth0};if("undefined"!=typeof Auth0Widget)throw new Error("Auth0Widget is not supported with this version of auth0-angularanymore. Please try with an older one");throw new Error("Cannot initialize Auth0Angular. Auth0Lock or Auth0 must be available")}var r={callbackOnLocationHash:!0},o=this,a={Auth0:{signin:"login",signinOnly:"signinOnly",signup:"signup",reset:"changePassword",validateUser:"validateUser",library:function(){return o.auth0js},parseOptions:function(n){var t=angular.copy(n);return t.authParams&&(angular.extend(t,t.authParams),delete t.authParams),t}},Auth0Lock:{signin:"show",signinOnly:"showSignin",signup:"showSignup",reset:"showReset",library:function(){return o.auth0lib},parseOptions:function(n){return angular.copy(n)}}};this.init=function(n,t){if(!n)throw new Error("You must set options when calling init");this.loginUrl=n.loginUrl,this.loginUrlParams=n.loginUrlParams,this.loginState=n.loginState,this.loginStateParams=n.loginStateParams,this.clientID=n.clientID||n.clientId;var i=n.domain;this.domain=i,this.sso=n.sso;var o=e(t);this.lib=o.lib,"Auth0Lock"===o.lib?(this.auth0lib=new o.constructor(this.clientID,i,angular.extend(r,n)),this.auth0js=this.auth0lib.getClient(),this.isLock=!0):(this.auth0lib=new o.constructor(angular.extend(r,n)),this.auth0js=this.auth0lib,this.isLock=!1),this.initialized=!0},this.eventHandlers={},this.on=function(n,t){this.eventHandlers[n]||(this.eventHandlers[n]=[]),this.eventHandlers[n].push(t)};var u=["loginSuccess","loginFailure","logout","forbidden","authenticated"];angular.forEach(u,function(t){o["add"+n.capitalize(t)+"Handler"]=function(n){o.on(t,n)}}),this.$get=["$rootScope","$q","$injector","$window","$location","authUtils","$http",function(n,e,r,u,s,l,c){function h(){o.loginUrl?s.path(o.loginUrl,o.loginUrlParams):o.loginState?r.get("$state").go(o.loginState,o.loginStateParams):p("forbidden")}function f(n,t,i,e){d.isAuthenticated||d.refreshTokenPromise||(o.sso?(n&&t.preventDefault(),o.auth0js.getSSOData(l.applied(function(r,o){if(o.sso){var a={popup:!1,callbackOnLocationHash:!0,connection:o.lastUsedConnection.name,authParams:{state:i()}};p("ssoLogin",{loginOptions:a}),d.signin(a,null,null,"Auth0")}else n&&(t.preventDefault(),e())}))):n&&(t.preventDefault(),e()))}var d={isAuthenticated:!1};n.isAuthenticated=!1;var g=function(n){return o.eventHandlers[n]},p=function(t,i){n.$broadcast("auth0."+t,i),angular.forEach(g(t)||[],function(n){r.invoke(n,d,i)})},v=function(t,i,e,r,o,a){t=t||o.idToken,i=i||o.accessToken,e=e||o.state,r=r||o.refreshToken;var u=d.getProfile(t),s={idToken:t,accessToken:i,state:e,refreshToken:r,profile:o,isAuthenticated:!0};return n.isAuthenticated=!0,angular.extend(d,s),p(a?"authenticated":"loginSuccess",angular.extend({profilePromise:u},s)),u};n.$on("$locationChangeStart",function(){if(o.initialized){var n=o.auth0lib.parseHash(u.location.hash);return!d.isAuthenticated&&n&&(n.idToken||n.id_token)?void v(n.idToken||n.id_token,n.accessToken||n.access_token,n.state,n.refreshToken||n.refresh_token):void 0}}),n.$on("auth0.forbiddenRequest",function(){h()}),o.loginUrl&&n.$on("$routeChangeStart",function(n,t){o.initialized&&f(t.$$route&&t.$$route.requiresLogin,n,function(){return JSON.stringify({redirect_to:{path:s.path()}})},function(){s.path(o.loginUrl,o.loginUrlParams)})}),o.loginState&&n.$on("$stateChangeStart",function(n,t,i){o.initialized&&f(t.data&&t.data.requiresLogin,n,function(){return JSON.stringify({redirect_to:{state:t.name,params:i}})},function(){r.get("$state").go(o.loginState,o.loginStateParams)})}),d.config=o;var k=function(n,t){var i=g("loginSuccess");if(!(t||n.username||n.email||i&&0!==i.length))throw new Error("You must define a loginSuccess handler if not using popup mode or not doing ro call because that means you are doing a redirect")},m=function(n,t,i){var e=i.user_id;return c({method:"POST",url:"https://"+o.domain+"/api/v2/users/"+e+"/identities",headers:{Authorization:"Bearer "+n},data:{link_with:t}})},y=function(n,t,i,e){return c({method:"DELETE",url:"https://"+o.domain+"/api/v2/users/"+t+"/identities/"+i+"/"+e,headers:{Authorization:"Bearer "+n}})};return d.hookEvents=function(){},d.init=angular.bind(o,o.init),d.getToken=function(n){n=n||{scope:"openid"},n.id_token||n.refresh_token||(n.id_token=d.idToken);var t=l.promisify(o.auth0js.getDelegationToken,o.auth0js);return t(n)},d.refreshIdToken=function(n){var t=l.promisify(o.auth0js.refreshToken,o.auth0js);return d.refreshTokenPromise=t(n||d.refreshToken).then(function(n){return n.id_token})["finally"](function(){d.refreshTokenPromise=null}),d.refreshTokenPromise},d.renewIdToken=function(n){var t=l.promisify(o.auth0js.renewIdToken,o.auth0js);return t(n||d.idToken).then(function(n){return n.id_token})},d.signin=function(n,e,r,u){n=n||{},k(n,e,r),n=i("parseOptions",u)(n);var s=t("signin",u),c=e?function(t,i,r,o,a){i=i||t.idToken,r=r||t.accessToken,o=o||t.state,a=a||t.refreshToken,i||angular.isUndefined(n.loginAfterSignup)||n.loginAfterSignup?v(i,r,o,a,t).then(function(n){e&&e(n,i,r,o,a)}):e()}:null,h=r?function(n){p("loginFailure",{error:n}),r&&r(n)}:null,f=l.callbackify(s,c,h,a[u||o.lib].library());f(n)},d.signinOnly=function(n,e,r,u){n=n||{},k(n,e,r),n=i("parseOptions",u)(n);var s=t("signinOnly",u),c=e?function(t,i,r,o,a){i||angular.isUndefined(n.loginAfterSignup)||n.loginAfterSignup?v(i,r,o,a,t).then(function(n){e&&e(n,i,r,o,a)}):e()}:null,h=r?function(n){p("loginFailure",{error:n}),r&&r(n)}:null,f=l.callbackify(s,c,h,a[u||o.lib].library());f(n)},d.signup=function(n,e,r){n=n||{},k(n,e,r),n=i("parseOptions")(n);var a=e?function(t,i,r,o,a){angular.isUndefined(n.auto_login)||n.auto_login?v(i,r,o,a,t).then(function(n){e&&e(n,i,r,o,a)}):e()}:null,u=r?function(n){p("loginFailure",{error:n}),r&&r(n)}:null,s=o.auth0lib,c=l.callbackify(t("signup"),a,u,s);c(n)},d.linkAccount=function(n,e,r,u,s,c){var h={popup:!0};if(!n||!e)throw new Error("Available token and profile is needed to link to another");if(!r.connection)throw new Error("Connection type (eg: facebook, github) is required to link account");r=r||{},k(r,u,s),angular.extend(r,h),r=i("parseOptions",c)(r);var f=t("signin",c),d=function(t,i){m(n,i,e).then(function(n){u(n)},function(n){s(n)})},g=function(n){s&&s(n)},p=l.callbackify(f,d,g,a[c||o.lib].library());p(r)},d.unLinkAccount=function(n,t,i,e){if(!(n&&t&&i&&e))throw new Error("All the arguments are required to unlink. Please refer to documentation for the arguments");return y(n,t,i,e)},d.reset=function(n,e,r){n=n||{},n=i("parseOptions")(n);var a=o.auth0lib,u=l.callbackify(t("reset"),e,r,a);u(n)},d.validateUser=function(n,e,r){n=n||{},n=i("parseOptions")(n);var a=o.auth0lib,u=l.callbackify(t("validateUser"),e,r,a);u(n)},d.signout=function(){d.isAuthenticated=!1,d.profile=null,d.profilePromise=null,d.idToken=null,d.state=null,d.accessToken=null,d.tokenPayload=null,n.isAuthenticated=!1,p("logout")},d.authenticate=function(n,t,i,e,r){return v(t,i,e,r,n,!0)},d.getProfile=function(n){var t=l.promisify(o.auth0lib.getProfile,o.auth0lib);return d.profilePromise=t(n||d.idToken),d.profilePromise.then(function(n){return d.profile=n,n})},d.hide=function(n){o.auth0lib.hide(n)},d}]}]),angular.module("auth0.directives",["auth0.service"]),angular.module("auth0.directives").directive("ifUser",["$rootScope",function(n){return{link:function(t,i){n.$watch("isAuthenticated",function(n){n?i.removeClass("ng-hide"):i.addClass("ng-hide")})}}}]);
